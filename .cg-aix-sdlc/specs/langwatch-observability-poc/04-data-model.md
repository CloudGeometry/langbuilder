# Data Model Design

**Change Request:** langwatch-observability-poc
**Generated:** 2026-01-21
**Step:** 4 - Data Model Design

---

## Context

Since this POC validates an **existing integration** with **zero code changes**, there are no new data models to design. This document describes the existing data structures for reference.

---

## Status: Not Applicable

**Reason:** No new data models are being created. The existing implementation uses:
1. Internal Python dataclasses/types
2. LangWatch SDK data structures

---

## Existing Data Structures

### TraceContext

```python
# services/tracing/service.py:60-80

class TraceContext:
    run_id: UUID | None
    run_name: str | None
    project_name: str | None
    user_id: str | None
    session_id: str | None
    tracers: dict[str, BaseTracer]
    all_inputs: dict[str, dict]
    all_outputs: dict[str, dict]
    traces_queue: asyncio.Queue
    running: bool
    worker_task: asyncio.Task | None
```

### ComponentTraceContext

```python
# services/tracing/service.py:83-101

class ComponentTraceContext:
    trace_id: str
    trace_name: str
    trace_type: str
    vertex: Vertex | None
    inputs: dict[str, dict]
    inputs_metadata: dict[str, dict]
    outputs: dict[str, dict]
    outputs_metadata: dict[str, dict]
    logs: dict[str, list[Log | dict]]
```

### LangWatchTracer State

```python
# services/tracing/langwatch.py:24-43

class LangWatchTracer(BaseTracer):
    flow_id: str
    trace_name: str
    trace_type: str
    project_name: str
    trace_id: UUID
    _ready: bool
    _client: langwatch  # SDK client
    trace: ContextTrace  # Active trace
    spans: dict[str, ContextSpan]  # Component spans
```

---

## Data Flow

### Input Data Transformation

```python
# services/tracing/langwatch.py:147-179

def _convert_to_langwatch_types(self, io_dict: dict[str, Any] | None):
    """Converts LangBuilder types to LangWatch types"""
    # Handles:
    # - dict: recursive conversion
    # - list: element-wise conversion
    # - Message: to chat message format
    # - Data: to document format
```

### Data Sent to LangWatch

| Field | Type | Source |
|-------|------|--------|
| trace_id | string | Graph run_id |
| span_id | string | vertex_id + nanoid |
| name | string | Component name |
| type | string | "workflow" or "component" |
| input | object | Component inputs (converted) |
| output | object | Component outputs (converted) |
| error | object | Exception if any |
| metadata.thread_id | string | Session ID |
| metadata.labels | array | Flow labels |

---

## Database Changes

**None required.**

The POC does not store any data locally. All trace data is sent to LangWatch cloud.

---

## Schema Migrations

**None required.**

---

**Metadata:**
- change_request: langwatch-observability-poc
- step: 4-data-model
- status: not_applicable
- generated_at: 2026-01-21

*Generated by CloudGeometry AIx SDLC - Phase 2 (Specs)*
