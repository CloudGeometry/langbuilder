# API Contract Design

**Change Request:** langwatch-observability-poc
**Generated:** 2026-01-21
**Step:** 3 - API Contract Design

---

## Context

Since this POC validates an **existing integration** with **zero code changes**, there are no new API contracts to design. This document describes the existing API interfaces for reference.

---

## Status: Not Applicable

**Reason:** No new APIs are being created. The existing LangWatch integration uses:
1. Internal Python interfaces (TracingService, BaseTracer)
2. External LangWatch API (via langwatch SDK)

---

## Existing Internal Interfaces

### TracingService Interface

```python
# services/tracing/service.py

class TracingService(Service):
    """Internal service - not an HTTP API"""

    async def start_tracers(
        self,
        run_id: UUID,
        run_name: str,
        user_id: str | None,
        session_id: str | None,
        project_name: str | None = None,
    ) -> None

    async def end_tracers(
        self,
        outputs: dict,
        error: Exception | None = None,
    ) -> None

    @asynccontextmanager
    async def trace_component(
        self,
        component: Component,
        trace_name: str,
        inputs: dict[str, Any],
        metadata: dict[str, Any] | None = None,
    )

    def get_langchain_callbacks(self) -> list[BaseCallbackHandler]
```

### BaseTracer Interface

```python
# services/tracing/base.py

class BaseTracer(ABC):
    """Internal interface - not an HTTP API"""

    @property
    @abstractmethod
    def ready(self) -> bool

    @abstractmethod
    def add_trace(
        self,
        trace_id: str,
        trace_name: str,
        trace_type: str,
        inputs: dict[str, Any],
        metadata: dict[str, Any] | None = None,
        vertex: Vertex | None = None,
    ) -> None

    @abstractmethod
    def end_trace(
        self,
        trace_id: str,
        trace_name: str,
        outputs: dict[str, Any] | None = None,
        error: Exception | None = None,
        logs: Sequence[Log | dict] = (),
    ) -> None

    @abstractmethod
    def end(
        self,
        inputs: dict[str, Any],
        outputs: dict[str, Any],
        error: Exception | None = None,
        metadata: dict[str, Any] | None = None,
    ) -> None

    @abstractmethod
    def get_langchain_callback(self) -> BaseCallbackHandler | None
```

---

## External API (LangWatch)

The langwatch SDK handles all external API communication. The SDK uses:

| Endpoint | Method | Purpose |
|----------|--------|---------|
| `/api/collector/traces` | POST | Send trace data |
| `/api/evaluations/list` | GET | List evaluators |
| `/api/evaluations/{name}/evaluate` | POST | Run evaluation |

**Note:** These are LangWatch cloud APIs, not LangBuilder APIs.

---

## POC Validation Points

For API contract validation, the POC will verify:

1. **TracingService.start_tracers()** - Initializes LangWatch tracer correctly
2. **LangWatchTracer.setup_langwatch()** - Checks environment variable
3. **LangWatchTracer.add_trace()** - Creates spans correctly
4. **LangWatchTracer.end()** - Sends data to LangWatch API
5. **get_langchain_callback()** - Returns valid callback handler

---

## No Changes Required

| Aspect | Status |
|--------|--------|
| New HTTP endpoints | None |
| New internal APIs | None |
| API modifications | None |
| Breaking changes | None |

---

**Metadata:**
- change_request: langwatch-observability-poc
- step: 3-api-contracts
- status: not_applicable
- generated_at: 2026-01-21

*Generated by CloudGeometry AIx SDLC - Phase 2 (Specs)*
